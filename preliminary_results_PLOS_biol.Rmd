---
title: "Preliminary results PLOS Biol"
output:
  html_document: 
    fig_height: 8
    fig_width: 12
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/media/Data/PLOS_Biol/")
knitr:::read_chunk('~/Documents/malaria_interventions/get_data_sqlite_plosbiol.R')
```

```{r LOAD PACKAGES, include=FALSE, echo=FALSE}
library(tidyverse)
library(magrittr)
library(sqldf)
library(igraph)
library(data.table)
library(googlesheets)
```

```{r INITIATE AND LOAD FUNCTIONS, cache=TRUE, include=FALSE}
<<FUNCTIONS>>

<<INITIALIZE>>
```

The design of the experiments (table with parameters) can be found [here](https://docs.google.com/spreadsheets/d/1OgWI-aBrAkT7gW2lbIBxsgRdyWgYO-9mNV6n3dtclTg/edit?usp=sharing). But here is a brief description.

|PS | N_GENES_INITIAL | BITING_RATE_MEAN | N_LOCI | N_ALLELES_INITIAL|
|---|-----------------|-----------------|--------|-------------------|
|01 |   120           |      0.1        |   2    | 12                |
|02 |   1200          |      0.2        |   2    | 120               |  
|03 |   12000         |      0.5        |   2    | 1200              |

* **PS**: parameter space: 01,02,03 for low, medium, high diversity.
* **exp**: 000 is to run to checkpoint; 001 is the experiment itself (no seasonality)


I kept daily biting rates fixed to 1.

# 1. Basic variables for each scenario across regimes

## 1.1 diversity

In the complete neutrality, the number of circulating strains seems just too much. This is orders of magnitude more than the selection.

### Selection
```{r basic_variables_S, cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<basic_variables_S>>
```

### Complete neutrality 

```{r basic_variables_N,  cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<basic_variables_N>>
```

### Generalized immunity 

```{r basic_variables_G,  cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<basic_variables_G>>
```


## 1.2 EIR
The EIR for selection seems too low? For neutrality it is an order of magnitude more.

### Selection
```{r EIR_S, cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<EIR_S>>
```

### Complete neutrality 
```{r EIR_N,  cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<EIR_N>>
```

### Generalized immunity
```{r EIR_G,  cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<EIR_G>>
```


# 2. Compare scenarios for a given regime

Notice the order of magnitude difference in the number of repertoires

### Low diversity & transmission
```{r compare_scenarios_01, cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<compare_scenarios_01>>
```

### Medium diversity & transmission
```{r compare_scenarios_02, cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<compare_scenarios_02>>
```

### High diversity & transmission
```{r compare_scenarios_03, cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"}
<<compare_scenarios_03>>
```

# 3. Edge weight values

### Selection
![](/media/Data/PLOS_Biol/Edge_weights_distributions_S.png)

### Complete Neutrality
![](/media/Data/PLOS_Biol/Edge_weights_distributions_N.png)

### Generalized immunity
![](/media/Data/PLOS_Biol/Edge_weights_distributions_G.png)

# 4. Cutoff (SELECTION)
Cutoff is based on the selection case, so we will look at it more closely. Then we will compare the behavior of the system across scenarios at different cutoffs.

### Examples for modules
![](/media/Data/PLOS_Biol/Results/module_examples_S.png)
### Persistence and relative persistence
Persistence (months)
![](/media/Data/PLOS_Biol/Results/persistence_boxplots.png)

Relative persistence
![](/media/Data/PLOS_Biol/Results/relative_persistence_boxplots.png)

### Modules per layer
![](/media/Data/PLOS_Biol/Results/modules_per_layer_boxplots.png)

### Repertoires in a module
![](/media/Data/PLOS_Biol/Results/Repertoires_per_module_boxplots.png)

# 5. Cutoff -- scenario comparison

### Examples for modules
![](/media/Data/PLOS_Biol/Results/module_examples_N.png)

![](/media/Data/PLOS_Biol/Results/module_examples_G.png)

## Persistence and relative persistence

### Module persistence
Persistence (months)
![](/media/Data/PLOS_Biol/Results/module_persistence_scenarios.png)
Relative persistence
![](/media/Data/PLOS_Biol/Results/module_relative_persistence_scenarios.png)


### Repertoire persistence
Persistence (months)
![](/media/Data/PLOS_Biol/Results/repertoire_persistence_scenarios.png)

Relative persistence
![](/media/Data/PLOS_Biol/Results/repertoire_relative_persistence_scenarios.png)

## Modules per layer
![](/media/Data/PLOS_Biol/Results/modules_per_layer_scenarios.png)

## Repertoires in a module
![](/media/Data/PLOS_Biol/Results/repertoires_per_module_scenarios.png)



<!-- # 4. Modularity -->
<!-- This will be influenced by cutoff. For now I am using the cutoffs I used in the previous version: 0.25 (low), 0.7 (medium), 0.9 (high). -->
<!-- ```{r Infomap_load, echo=FALSE, fig.height=9, fig.width=16, message=FALSE, warning=FALSE, cache=TRUE, dpi=96, out.height="1080px", out.width="1920px"} -->
<!-- <<Infomap_load>> -->
<!-- ``` -->

<!-- # 4.1 Example of modules -->
<!-- ```{r Infomap_module_example, cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"} -->
<!-- <<Infomap_module_example>> -->
<!-- ``` -->

<!-- # 4.2 Module and strain persistence -->

<!-- ## Relative persistence -->
<!-- Persistence of repertories is after removing duplicates. Gray is repertoires. -->
<!-- ```{r Infomap_relative_persistence, cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"} -->
<!-- <<Infomap_relative_persistence>> -->
<!-- ``` -->

<!-- ## Absolute persistence -->
<!-- Persistence of repertories is after removing duplicates. Gray is repertoires. -->
<!-- ```{r Infomap_persistence, cache=TRUE, echo=FALSE, fig.width=16,fig.height=9,dpi=96,out.width="1920px",out.height="1080px"} -->
<!-- <<Infomap_persistence>> -->
<!-- ``` -->